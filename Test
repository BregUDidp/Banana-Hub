local coTab = Window:CreateTab("||   - Mapping Time", "map-pinned")
local Section = coTab:CreateSection("")
local Section = coTab:CreateSection("{ [ - User Name:  All In One  :Target - ] }")

local PlayerListParagraph = coTab:CreateParagraph({
    Title = "All Name Player In List",
    Content = "Loading..."
})

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á 5 ‡∏ß‡∏¥)
local leavingPlayers = {}  -- {player = {timestamp = tick()}}

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
local function UpdatePlayerList()
    local players = game.Players:GetPlayers()
    local nameList = {}
    
    local numberWidth = 5
    local currentTime = tick()
    
    -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)
    for i, player in ipairs(players) do
        local numbered = string.format("%" .. numberWidth .. "d.   üü¢   ", i)
        local entry = numbered .. player.Name .. "    (  [    " .. player.DisplayName .. "    ]  )"
        table.insert(nameList, entry)
        
        -- ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å leavingPlayers ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (‡∏Å‡∏£‡∏ì‡∏µ reconnect ‡πÄ‡∏£‡πá‡∏ß)
        leavingPlayers[player] = nil
    end
    
    -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 5 ‡∏ß‡∏¥) ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á
    for player, data in pairs(leavingPlayers) do
        if currentTime - data.timestamp <= 4 then
            local numbered = string.format("%" .. numberWidth .. "d.   üî¥   ", data.oldIndex or 999)
            local entry = numbered .. player.Name .. "    (  [    " .. player.DisplayName .. "    ]  )  <font color=\"rgb(255,100,100)\"> --- üí• ---</font>"
            table.insert(nameList, entry)
        else
            -- ‡∏Ñ‡∏£‡∏ö 5 ‡∏ß‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            leavingPlayers[player] = nil
        end
    end
    
    -- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô, ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á)
    table.sort(nameList)
    
    local fullText
    if #nameList == 0 and next(leavingPlayers) == nil then
        fullText = "No Found Player In List"
    else
        fullText = table.concat(nameList, "\n\n\n")
    end
    
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Paragraph
    PlayerListParagraph:Set({
        Title = "                                                                                                                      (   " .. #players .. "   Player  )",
        Content = fullText
    })
end

-- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
game.Players.PlayerAdded:Connect(function(player)
    UpdatePlayerList()
    
    if game.Players.LocalPlayer:IsFriendsWith(player.UserId) then
    end
end)

-- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏Å
game.Players.PlayerRemoving:Connect(function(player)

    local players = game.Players:GetPlayers()
    local oldIndex = 1
    for i, p in ipairs(players) do
        if p == player then
            oldIndex = i
            break
        end
    end
    
    leavingPlayers[player] = {
        timestamp = tick(),
        oldIndex = oldIndex,
        DisplayName = player.DisplayName
    }
    
     Rayfield:Notify({
        Title = "[ üî¥ ]  Player Leave Game",
        Content = player.Name .. "  (  " .. player.DisplayName .. "  )",
        Duration = 4,
        Image = "door-closed",
    })
    
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á
    UpdatePlayerList()
    
    -- ‡∏£‡∏≠ 5 ‡∏ß‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á ‡πÜ
    task.delay(5, UpdatePlayerList)
end)

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö 5 ‡∏ß‡∏¥‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ event ‡∏≠‡∏∑‡πà‡∏ô)
task.spawn(function()
    while task.wait(1) do
        if next(leavingPlayers) then
            UpdatePlayerList()
        end
    end
end)

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
UpdatePlayerList()

local Section = coTab:CreateSection("")
