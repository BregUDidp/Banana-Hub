local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
 
-- สร้าง Window
local Window = Rayfield:CreateWindow({
   Name = "📟 BalonX Aimbot  [⭐ Premuim ⭐]",
   Icon = 1, -- Icon in Topbar. Can use Lucide Icons (string) or Roblox Image (number). 0 to use no icon (default).
   LoadingTitle = "[📟] BalonX Aimbot [📟]",
   LoadingSubtitle = "ผู้ผลิตสคริป By [📟] XaS [📟]",
   ShowText = "[📟] BalonX [📟]", -- for mobile users to unhide rayfield, change if you'd like
   Theme = "Ocean", -- Check https://docs.sirius.menu/rayfield/configuration/themes
 
   ToggleUIKeybind = "F", -- The keybind to toggle the UI visibility (string like "F" or Enum.KeyCode)
 
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false, -- Prevents Rayfield from warning when the script has a version mismatch with the interface
 
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil, -- Create a custom folder for your hub/game
      FileName = "Big Hub"
   },
 
   Discord = {
      Enabled = false, -- Prompt the user to join your Discord server if their executor supports it
      Invite = "XaS", -- The Discord invite code, do not include discord.gg/. E.g. discord.gg/ ABCD would be ABCD
      RememberJoins = true -- Set this to false to make them join the discord every time they load it up
   },
 
   KeySystem = true, -- Set this to true to use our key system
   KeySettings = {
      Title = "📟 BalonX พร้อมโหลดถ้าใส่คีย์เสร็จ",
      Subtitle = "[📟] ไปเอาคีย์ในดิส [📟]",
      Note = "[📟] Key = BALON-0101  [📟]",
      FileName = "📟 Key BalonX 📟", -- It is recommended to use something unique as other scripts using Rayfield may overwrite your key file
      SaveKey = false, -- The user's key will be saved, but if you change the key, they will be unable to use your script
      GrabKeyFromSite = true, -- If this is true, set Key below to the RAW site you would like Rayfield to get the key from
      Key = {"BALON-0101"} -- List of keys that will be accepted by the system, can be RAW file links (pastebin, github etc) or simple strings ("hello","key22")
   }
})
Rayfield:Notify({
   Title = "📟 ค่ายสคริป Aimbot สคริปกำลังโหลดน่ะจ๊ะ...",
   Content = "📟 ค่ายสคริป Aimbot สคริปกำลังโหลดนะจ๊ะ...",
   Duration = 5,
   Image = nil,
})
 
local ESPTab = Window:CreateTab("🌀 การเห็นคน/การล็อคเป๋า", nil)
local Section = ESPTab:CreateSection("📟 Menu Circle 📟")
-- ตัวแปรหลัก

local plrs = game:GetService("Players")
local plr = plrs.LocalPlayer
local cam = workspace.CurrentCamera
local input = game:GetService("UserInputService")
local run = game:GetService("RunService")
local aimbotOn = false
local target = nil
local holding = false

function GetClosest()
    local closest = nil
    local dist = math.huge
    local mousePos = input:GetMouseLocation()

    for _, v in pairs (plrs:GetPlayers()) do
        if v ~= plr and v.Character and v.Character:FindFirstChild("Head") and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
            local pos, vis = cam:WorldToViewportPoint(v.Character.Head.Position)
            if vis then
                local mag = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                if mag < dist then
                    dist = mag
                    closest = v 
                end
            end
        end
    end
    return closest
end

-- 🔵 FOV Circle แบบ Rainbow เปิด/ปิดได้
local fovEnabled = false
local fovRadius = 150
local fovThickness = 2
local fovSpeed = 0.6
local fovFollowMouse = false

local drawingAvailable = typeof(Drawing) == "table" and typeof(Drawing.new) == "function"
local fovCircle = nil

local function getRainbowColor(speed, offset)
    local hue = (tick() * (speed or 1) + (offset or 0)) % 1
    return Color3.fromHSV(hue, 1, 1)
end

local function createFOVCircle()
    if not drawingAvailable then return end
    if fovCircle then return end

    local c = Drawing.new("Circle")
    c.Visible = false
    c.Radius = fovRadius
    c.Thickness = fovThickness
    c.NumSides = 100
    c.Filled = false
    c.Transparency = 1
    fovCircle = c
end

local function removeFOVCircle()
    if fovCircle then
        fovCircle:Remove()
        fovCircle = nil
    end
end

-- เริ่มวาดวงกลม
run.RenderStepped:Connect(function()
    if not fovEnabled or not fovCircle then
        if fovCircle then fovCircle.Visible = false end
        return
    end

    local pos
    if fovFollowMouse then
        local mouse = input:GetMouseLocation()
        pos = Vector2.new(mouse.X, mouse.Y)
    else
        local view = cam.ViewportSize
        pos = Vector2.new(view.X / 2, view.Y / 2)
    end

    fovCircle.Position = pos
    fovCircle.Color = getRainbowColor(fovSpeed)
    fovCircle.Thickness = fovThickness
    fovCircle.Radius = fovRadius
    fovCircle.Visible = true
end)

-- สร้าง UI สำหรับ FOV ในแท็บการมองเห็น
ESPTab:CreateToggle({
    Name = "🌀 เปิดวงกลม/ปิดวงกลม",
    CurrentState = false,
    Flag = "FOVToggle",
    Callback = function(val)
        fovEnabled = val
        if val then
            createFOVCircle()
        else
            if fovCircle then fovCircle.Visible = false end
        end
    end
})

ESPTab:CreateToggle({
    Name = "🖱️ วงตามเมาส์",
    CurrentState = false,
    Flag = "FOVMouseFollow",
    Callback = function(val)
        fovFollowMouse = val
    end
})

ESPTab:CreateSlider({
    Name = "📏 ขนาดวงวงกลม",
    Range = {10, 1000},
    Increment = 1,
    CurrentValue = fovRadius,
    Suffix = "px",
    Flag = "FOVRadius",
    Callback = function(val)
        fovRadius = val
        if fovCircle then fovCircle.Radius = val end
    end
})

ESPTab:CreateSlider({
    Name = "📏 ความหนาเส้นวงกลม",
    Range = {1, 10},
    Increment = 1,
    CurrentValue = fovThickness,
    Suffix = "px",
    Flag = "FOVThickness",
    Callback = function(val)
        fovThickness = val
        if fovCircle then fovCircle.Thickness = val end
    end
})

-- ======= Services & Vars =======
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local cam = workspace.CurrentCamera
local RunService = game:GetService("RunService")

-- Drawing availability
local DrawingAvailable = (typeof(Drawing) == "table" and typeof(Drawing.new) == "function")

-- ESP vars
local espEnabled = false
local espTraceEnabled = true
local espBoxes = {}
local espVisible = {}
local espRainbowSpeed = 0.9
local espGlowLayers = 3
local espMaxBoxSize = 200

-- Rainbow color function
local function rainbowColor(speed, offset)
    local t = tick() * (speed or 1) + (offset or 0)
    return Color3.fromHSV(t % 1, 1, 1)
end

-- Create ESP drawing objects
local function createESPForPlayer(player)
    if not DrawingAvailable or espBoxes[player] then return end

    local boxData = {}

    -- Main box
    boxData.main = Drawing.new("Square")
    boxData.main.Visible = false
    boxData.main.Filled = false
    boxData.main.Thickness = 1

    -- Glow layers
    boxData.glows = {}
    for i = 1, espGlowLayers do
        local g = Drawing.new("Square")
        g.Visible = false
        g.Filled = false
        g.Thickness = 1
        g.Transparency = math.clamp(0.55 * (1 - (i - 1)/espGlowLayers), 0.03, 0.9)
        table.insert(boxData.glows, g)
    end

    -- Name tag
    boxData.name = Drawing.new("Text")
    boxData.name.Visible = false
    boxData.name.Center = true
    boxData.name.Size = 14

    -- Health bar
    boxData.health = Drawing.new("Square")
    boxData.health.Visible = false
    boxData.health.Filled = true

    -- Tracer line
    boxData.tracer = Drawing.new("Line")
    boxData.tracer.Visible = false
    boxData.tracer.Thickness = 1

    espBoxes[player] = boxData
end

-- Remove ESP drawing objects
local function removeESPForPlayer(player)
    local box = espBoxes[player]
    if box then
        pcall(function()
            if box.main then box.main:Remove() end
            if box.name then box.name:Remove() end
            if box.health then box.health:Remove() end
            if box.tracer then box.tracer:Remove() end
            for _, g in ipairs(box.glows) do g:Remove() end
        end)
        espBoxes[player] = nil
        espVisible[player] = nil
    end
end

-- Render loop
RunService.RenderStepped:Connect(function()
    if not DrawingAvailable then return end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            if espEnabled then
                createESPForPlayer(player)
                local box = espBoxes[player]
                local hrp = player.Character.HumanoidRootPart
                local rootPos, onScreen = cam:WorldToViewportPoint(hrp.Position)

                if onScreen then
                    espVisible[player] = true
                    local depth = (cam.CFrame.Position - hrp.Position).Magnitude
                    local scale = math.clamp(2000 / depth, 20, espMaxBoxSize)
                    local boxSize = Vector2.new(scale * 0.6, scale)
                    local center = Vector2.new(rootPos.X, rootPos.Y)

                    -- Main box
                    if box.main then
                        box.main.Size = boxSize
                        box.main.Position = center - (boxSize / 2)
                        box.main.Color = rainbowColor(espRainbowSpeed, 0)
                        box.main.Visible = true
                    end

                    -- Glow layers
                    for i, g in ipairs(box.glows) do
                        local extra = i * 6
                        g.Size = boxSize + Vector2.new(extra, extra)
                        g.Position = center - (g.Size / 2)
                        g.Color = rainbowColor(espRainbowSpeed, i * 0.07)
                        g.Visible = true
                    end

                    -- Name tag
                    if box.name then
                        box.name.Position = center + Vector2.new(0, -boxSize.Y/2 - 14)
                        box.name.Text = player.Name
                        box.name.Color = rainbowColor(espRainbowSpeed, 0.15)
                        box.name.Visible = true
                    end

                    -- Tracer
                    if box.tracer then
                        local screenCenter = Vector2.new(cam.ViewportSize.X / 2, cam.ViewportSize.Y / 2)
                        box.tracer.From = screenCenter
                        box.tracer.To = center
                        box.tracer.Color = rainbowColor(espRainbowSpeed, 0.25)
                        box.tracer.Visible = espTraceEnabled
                    end

                    -- Health bar
                    local humanoid = player.Character:FindFirstChild("Humanoid")
                    if humanoid and box.health then
                        local hpPct = math.clamp(humanoid.Health / (humanoid.MaxHealth or 100), 0, 1)
                        local healthW = 4
                        local healthH = boxSize.Y * hpPct
                        local healthPos = center - Vector2.new(boxSize.X/2 + 8, boxSize.Y/2 - healthH)
                        box.health.Size = Vector2.new(healthW, healthH)
                        box.health.Position = healthPos
                        box.health.Color = rainbowColor(espRainbowSpeed, hpPct * 0.5)
                        box.health.Visible = true
                    end
                else
                    -- Out of screen
                    espVisible[player] = false
                    if box.main then box.main.Visible = false end
                    if box.name then box.name.Visible = false end
                    if box.health then box.health.Visible = false end
                    if box.tracer then box.tracer.Visible = false end
                    for _, g in ipairs(box.glows) do g.Visible = false end
                end
            else
                removeESPForPlayer(player)
            end
        else
            removeESPForPlayer(player)
        end
    end
end)

-- Cleanup when player leaves
Players.PlayerRemoving:Connect(removeESPForPlayer)

-- ======= UI Controls =======Tab:CreateToggle({
local Section3 = ESPTab:CreateSection("📟 Menu ESP/AimBot 📟")

ESPTab:CreateToggle({
    Name = "🎯 ล็อกเป๋าหมาย [ กดคลิกขวา ]",
    CurrentState = false,
    Flag = "a",
    Callback = function(val)
        aimbotOn = val
    end
})

input.InputBegan:Connect(function(key)
    if key.UserInputType == Enum.UserInputType.MouseButton2 then
        holding = true
        target = GetClosest()
    end
end)

input.InputEnded:Connect(function(key)
    if key.UserInputType == Enum.UserInputType.MouseButton2 then
        holding = false
        target = nil
    end
end)

run.RenderStepped:Connect(function()
    if aimbotOn and holding and target and target.Character and target.Character.Head then
        cam.CFrame = CFrame.new(cam.CFrame.Position, target.Character.Head.Position)
    end
end)

local FeatureEnabled = false
local ESPHighlights = {}
local BloodGuis = {}
local Tracers = {}
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local cam = workspace.CurrentCamera
local RunService = game:GetService("RunService")


ESPTab:CreateToggle({
    Name = "🔍 เปิดการมองเห็นคน",
    CurrentState = espEnabled,
    Flag = "esp_enable",
    Callback = function(val)
        espEnabled = val
        if not val then
            for p,_ in pairs(espBoxes) do
                removeESPForPlayer(p)
            end
        end
    end
})

ESPTab:CreateToggle({
    Name = "🔍 การมองเห็นคนแบบเส้น",
    CurrentState = espTraceEnabled,
    Flag = "esp_tracer",
    Callback = function(val)
        espTraceEnabled = val
    end
})

-- Notification เมื่อโหลด
Rayfield:Notify({
    Title = "⭐ โหลดสำเร็จ ⭐",
    Content = "สคริปต์ 📟 BalonX Aimbot พร้อมใช้งาน!",
    Duration = 5
})

print("[DEBUG] สคริปต์โหลดสำเร็จ")
