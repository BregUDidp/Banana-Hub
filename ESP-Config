-- Load Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Rainbow ESP & Tracers", "Ocean") -- Theme: Ocean (dark/blue)

-- ESP Tab
local ESPTab = Window:NewTab("ESP")
local ESPSection = ESPTab:NewSection("Rainbow ESP and Tracers Controls")

-- Variables
local ESPEnabled = false
local RainbowEnabled = false
local TracersEnabled = false
local TracerThickness = 2 -- Default thickness
local ESPObjects = {}

-- Camera for screen positioning
local Camera = game:GetService("Workspace").CurrentCamera

-- Core ESP Function (Highlights + Tracers)
local function CreateESP(Player)
    if Player == game.Players.LocalPlayer then return end
    local Character = Player.Character
    if not Character or not Character:FindFirstChild("HumanoidRootPart") then return end

    -- Highlight
    local Highlight = Instance.new("Highlight")
    Highlight.Parent = Character
    Highlight.FillColor = Color3.fromRGB(255, 0, 0) -- Start with red
    Highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    Highlight.FillTransparency = 0.5
    Highlight.OutlineTransparency = 0
    Highlight.Adornee = Character

    -- Name Label
    local BillboardGui = Instance.new("BillboardGui")
    BillboardGui.Parent = Character.Head
    BillboardGui.Size = UDim2.new(0, 100, 0, 50)
    BillboardGui.StudsOffset = Vector3.new(0, 2, 0)
    BillboardGui.AlwaysOnTop = true

    local NameLabel = Instance.new("TextLabel")
    NameLabel.Parent = BillboardGui
    NameLabel.Size = UDim2.new(1, 0, 1, 0)
    NameLabel.BackgroundTransparency = 1
    NameLabel.Text = Player.Name
    NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameLabel.TextScaled = true
    NameLabel.Font = Enum.Font.SourceSansBold

    -- Tracer
    local Tracer = Drawing.new("Line")
    Tracer.Visible = TracersEnabled
    Tracer.Color = Color3.fromRGB(255, 0, 0)
    Tracer.Thickness = TracerThickness
    Tracer.Transparency = 1

    ESPObjects[Player] = {Highlight = Highlight, Label = NameLabel, Tracer = Tracer}
end

local function RemoveESP(Player)
    if ESPObjects[Player] then
        ESPObjects[Player].Highlight:Destroy()
        ESPObjects[Player].Label:Destroy()
        ESPObjects[Player].Tracer:Remove()
        ESPObjects[Player] = nil
    end
end

local function UpdateTracers()
    for Player, Obj in pairs(ESPObjects) do
        if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") and TracersEnabled then
            local RootPart = Player.Character.HumanoidRootPart
            local ScreenPos, OnScreen = Camera:WorldToViewportPoint(RootPart.Position)
            if OnScreen then
                Obj.Tracer.Visible = true
                Obj.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y) -- Bottom of screen
                Obj.Tracer.To = Vector2.new(ScreenPos.X, ScreenPos.Y)
                Obj.Tracer.Thickness = TracerThickness -- Update thickness
            else
                Obj.Tracer.Visible = false
            end
        else
            Obj.Tracer.Visible = false
        end
    end
end

local function UpdateRainbow()
    if not RainbowEnabled then return end
    for Player, Obj in pairs(ESPObjects) do
        if Player.Character and Player.Character.Parent then
            local Time = tick()
            local RainbowColor = Color3.fromHSV((Time * 0.5) % 1, 1, 1) -- HSV for rainbow cycle
            Obj.Highlight.FillColor = RainbowColor
            Obj.Label.TextColor3 = RainbowColor
            Obj.Tracer.Color = RainbowColor
        end
    end
end

-- Kavo UI Toggles and Sliders
ESPSection:NewToggle("Enable ESP", "Toggles player highlights and labels", function(State)
    ESPEnabled = State
    if State then
        for _, Player in pairs(game.Players:GetPlayers()) do
            CreateESP(Player)
        end
        game.Players.PlayerAdded:Connect(CreateESP)
        game.Players.PlayerRemoving:Connect(RemoveESP)
        spawn(function()
            while ESPEnabled do
                UpdateTracers()
                UpdateRainbow()
                wait(0.1)
            end
        end)
    else
        for Player, _ in pairs(ESPObjects) do
            RemoveESP(Player)
        end
    end
end)

ESPSection:NewToggle("Enable Tracers", "Toggles lines to players", function(State)
    TracersEnabled = State
    for _, Obj in pairs(ESPObjects) do
        Obj.Tracer.Visible = State and ESPEnabled
    end
end)

ESPSection:NewToggle("Rainbow Mode", "Cycles colors on ESP and tracers", function(State)
    RainbowEnabled = State
    if State and ESPEnabled then
        spawn(function()
            while RainbowEnabled and ESPEnabled do
                UpdateRainbow()
                wait(0.1)
            end
        end)
    end
end)

ESPSection:NewSlider("ESP Transparency", "Adjust fill transparency (0-1)", 100, 0, function(Value)
    local Transparency = Value / 100
    for _, Obj in pairs(ESPObjects) do
        if Obj.Highlight then
            Obj.Highlight.FillTransparency = Transparency
        end
    end
end)

ESPSection:NewSlider("Tracer Thickness", "Adjust tracer line thickness (1-10)", 10, 1, function(Value)
    TracerThickness = Value
    for _, Obj in pairs(ESPObjects) do
        if Obj.Tracer then
            Obj.Tracer.Thickness = TracerThickness
        end
    end
end)

-- Credits Tab
local CreditsTab = Window:NewTab("Credits")
local CreditsSection = CreditsTab:NewSection("Info")
CreditsSection:NewLabel("Adapted from wa0101/Roblox-ESP | UI by xHeptc")
CreditsSection:NewLabel("Use at your own risk - No ban protection!")
