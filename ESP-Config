-- Load Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("üåÄ ‡∏°‡∏≠‡∏á‡∏Ñ‡∏ô/‡∏°‡∏≠‡∏á‡∏ó‡∏∞‡∏•‡∏∏", "BloodTheme")

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- ESP Variables
local ESPEnabled = false
local ESPObjects = {}

-- ESP Functions
local function CreateESP(player)
    if player == LocalPlayer then return end
    
    local function CreateBox()
        local box = Drawing.new("Square")
        box.Visible = false
        box.Color = Color3.fromRGB(255, 0, 0)  -- ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π
        box.Thickness = 2
        box.Filled = false
        box.Transparency = 1
        return box
    end
    
    local function CreateTracer()
        local tracer = Drawing.new("Line")
        tracer.Visible = false
        tracer.Color = Color3.fromRGB(255, 0, 0)
        tracer.Thickness = 1
        tracer.Transparency = 1
        return tracer
    end
    
    local function CreateName()
        local name = Drawing.new("Text")
        name.Visible = false
        name.Color = Color3.fromRGB(255, 255, 255)
        name.Size = 16
        name.Center = true
        name.Outline = true
        name.Font = 2
        name.Text = player.Name
        return name
    end
    
    local esp = {
        Box = CreateBox(),
        Tracer = CreateTracer(),
        Name = CreateName(),
        Player = player
    }
    
    table.insert(ESPObjects, esp)
end

local function UpdateESP()
    for _, esp in pairs(ESPObjects) do
        local player = esp.Player
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Head") then
            local rootPart = player.Character.HumanoidRootPart
            local head = player.Character.Head
            local humanoid = player.Character:FindFirstChild("Humanoid")
            
            if humanoid and humanoid.Health > 0 then
                local rootPos, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
                local headPos = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
                local legPos = Camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 3, 0))
                
                if onScreen then
                    -- Box ESP
                    local size = (headPos - legPos).Magnitude
                    esp.Box.Size = Vector2.new(2000 / rootPos.Z, size)
                    esp.Box.Position = Vector2.new(rootPos.X - esp.Box.Size.X / 2, rootPos.Y - esp.Box.Size.Y / 2)
                    esp.Box.Visible = true
                    
                    -- Tracer
                    esp.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                    esp.Tracer.To = Vector2.new(rootPos.X, rootPos.Y)
                    esp.Tracer.Visible = true
                    
                    -- Name
                    esp.Name.Position = Vector2.new(rootPos.X, rootPos.Y - esp.Box.Size.Y / 2 - 20)
                    esp.Name.Visible = true
                else
                    esp.Box.Visible = false
                    esp.Tracer.Visible = false
                    esp.Name.Visible = false
                end
            else
                esp.Box.Visible = false
                esp.Tracer.Visible = false
                esp.Name.Visible = false
            end
        else
            esp.Box.Visible = false
            esp.Tracer.Visible = false
            esp.Name.Visible = false
        end
    end
end

local function ToggleESP(state)
    ESPEnabled = state
    if state then
        for _, player in pairs(Players:GetPlayers()) do
            if not table.find(ESPObjects, function(esp) return esp.Player == player end) then
                CreateESP(player)
            end
        end
        RunService.RenderStepped:Connect(UpdateESP)
    else
        for _, esp in pairs(ESPObjects) do
            esp.Box:Remove()
            esp.Tracer:Remove()
            esp.Name:Remove()
        end
        ESPObjects = {}
    end
end

-- UI Tab
local MainTab = Window:NewTab("ESP Settings")
local MainSection = MainTab:NewSection("Main Features")

MainSection:NewToggle("Enable ESP", "‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ESP ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", function(state)
    ToggleESP(state)
end)

MainSection:NewSlider("ESP Distance", "‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á ESP (studs)", 500, 1, function(value)
    -- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö distance check ‡πÉ‡∏ô UpdateESP ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    print("ESP Distance set to: " .. value)
end)

-- Player Tab
local PlayerTab = Window:NewTab("Player List")
local PlayerSection = PlayerTab:NewSection("Players")

for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        PlayerSection:NewToggle(player.Name, "‡πÄ‡∏õ‡∏¥‡∏î ESP ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö " .. player.Name, function(state)
            -- Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö toggle ‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)
            print("Toggled ESP for " .. player.Name .. ": " .. tostring(state))
        end)
    end
end

-- Handle new players
Players.PlayerAdded:Connect(function(player)
    if ESPEnabled then
        CreateESP(player)
    end
    -- Refresh UI if needed
end)

-- Notification
Library:Notify("ESP Hub Loaded! Use the toggle to start.", 5)
